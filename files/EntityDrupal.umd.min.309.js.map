{"version":3,"file":"EntityDrupal.umd.min.309.js","mappings":"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","sources":["webpack://EntityDrupal/./src/views/TextDuplicateEntities.vue?39de","webpack://EntityDrupal/src/views/TextDuplicateEntities.vue","webpack://EntityDrupal/./src/views/TextDuplicateEntities.vue?5ad1","webpack://EntityDrupal/./src/views/TextDuplicateEntities.vue"],"sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('b-button',{attrs:{\"variant\":\"info\"},on:{\"click\":_vm.duplicateEntities}},[_vm._v(\" duplicate entities \")]),_c('div',[_vm._v(\"numbersEntities: \"+_vm._s(_vm.numbersEntities))])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div>\n    <b-button variant=\"info\" @click=\"duplicateEntities\">\n      duplicate entities\n    </b-button>\n    <div>numbersEntities: {{ numbersEntities }}</div>\n  </div>\n</template>\n<script>\nimport { mapState, mapGetters } from \"vuex\";\nexport default {\n  name: \"TextDuplicateEntities\",\n  data() {\n    return {\n      payload: {\n        id: 139, //152, //139,\n        content: {\n          name: [\n            {\n              value: \"Bienvenue chez test\",\n            },\n          ],\n          field_domain_access: [\n            {\n              target_id: \"test328_wb_horizon_kksa\",\n            },\n          ],\n          field_domain_source: [\n            {\n              target_id: \"test328_wb_horizon_kksa\",\n            },\n          ],\n          is_default_theme: [\n            {\n              value: false,\n            },\n          ],\n        },\n      },\n    };\n  },\n\n  computed: {\n    ...mapState([\"entityDuplicate\"]),\n    ...mapGetters([\"numbersEntities\"]),\n  },\n  mounted() {\n    //\n  },\n  methods: {\n    duplicateEntities() {\n      this.$store.dispatch(\"getMatriceEntities\", this.payload).then(() => {\n        this.prepareSaveEntities(this.$store.state);\n      });\n    },\n    prepareSaveEntities(state) {\n      /**\n       * Permet de creer les sous contenus et return les target_ids.\n       * @param {Array} items\n       * @param {Integer} i\n       * @param {Array} values\n       */\n      const loopItem = (items, i, values = []) => {\n        return new Promise((resolv, reject) => {\n          console.log(\"loopItem : \", items);\n          if (items[i]) {\n            const item = items[i];\n            if (items[i].entities) {\n              const keys = Object.keys(items[i].entities);\n              loopFieldEntity(\n                items[i].entities,\n                keys[0],\n                items[i].entity,\n                keys,\n                0\n              ).then((entity) => {\n                this.$store\n                  .dispatch(\"saveEntity\", {\n                    entity_type_id: items[i].target_type,\n                    value: entity,\n                    index: i,\n                  })\n                  .then((resp) => {\n                    //items[i].entity = resp.data.json;\n                    values.push({ target_id: resp.data.id });\n                    i = i + 1;\n                    if (i < items.length) {\n                      // loopEntityPromise(items, i).then((resp) => {\n                      //   values.push({ target_id: resp.data.id });\n                      // });\n                      resolv(loopItem(items, i, values));\n                    } else resolv(values);\n                  })\n                  .catch((er) => {\n                    console.log(\" catch : \", er);\n                    reject(er);\n                  });\n              });\n            } else {\n              this.$store\n                .dispatch(\"saveEntity\", {\n                  entity_type_id: item.target_type,\n                  value: item.entity,\n                  index: i,\n                })\n                .then((resp) => {\n                  values.push({ target_id: resp.data.id });\n                  i = i + 1;\n                  if (items.length <= i) {\n                    resolv(loopItem(items, i, values));\n                  } else {\n                    resolv(values);\n                  }\n                })\n                .catch((er) => {\n                  console.log(\"catch : \", er);\n                  reject(er);\n                });\n            }\n          } else resolv(values);\n        });\n      };\n      //\n      /**\n       * loopFieldEntity parcourt les entites enfants d'une entité parente, et a chaque passage MAJ l'entité parent.\n       *\n       * @param {Array} datas // tableau des entites enfants.\n       * @param {String} fieldname // fieldname\n       * @param {String} entity // entité parente\n       * @param {Array} keys // tableau des champs à parcourirt (permet de passer à l'etape suivante)\n       * @param {Integer} i   // l'etape encours (permet de passer à l'etape suivante)\n       * @return {Object} entity // l'entité parente MAJ.\n       */\n      const loopFieldEntity = (datas, fieldname, entity, keys, i) => {\n        return new Promise((resolv) => {\n          console.log(\"loopFieldEntity : \", datas);\n          // Si le champs contient des données,\n          // on parcourt chacune des entrées.\n          if (datas[fieldname] && datas[fieldname].length > 0) {\n            // Pour chaque champs, on cree les contenus et on recupere les ids.\n            loopItem(datas[fieldname], 0).then((resp) => {\n              console.log(\"loopFieldEntity result of loopItem : \", resp);\n              entity[fieldname] = resp;\n              // on passe au champs suivant.\n              i = i + 1;\n              if (keys.length > i) {\n                resolv(loopFieldEntity(datas, keys[i], entity, keys, i));\n              } else {\n                resolv(entity);\n              }\n            });\n          } else resolv(entity);\n        });\n      };\n      /**\n       * Permet de cree l'entité parent, apres que tous les entitées enfants soient ok.\n       * il est appelle par tous les enfants possedant des enfants.\n       * loopEntityPromise recois un tableau contenant les entites qui doivent etre cree.\n       * il retourne un tableau de target_ids => [{target_id:...},{target_id:...}, ... ].\n       *\n       * @param {*} datas\n       * @param {*} i\n       * @return resp [{id:..., json:...}] // return un json avec une proprieté json et une autre id.\n       */\n      const loopEntityPromise = (datas, i = null, values = []) => {\n        return new Promise((resolv, reject) => {\n          console.log(\"loopEntityPromise : \", datas);\n          if (datas[i]) {\n            // S'il contient des sous entités.\n            if (datas[i].entities && typeof datas[i].entities === \"object\") {\n              const keys = Object.keys(datas[i].entities);\n              loopFieldEntity(\n                datas[i].entities,\n                keys[0],\n                datas[i].entity,\n                keys,\n                0\n              ).then((entity) => {\n                console.log(\n                  \" loopEntityPromise SEND with override entity : \",\n                  entity\n                );\n                this.$store\n                  .dispatch(\"saveEntity\", {\n                    entity_type_id: datas[i].target_type,\n                    value: entity,\n                    index: i,\n                  })\n                  .then((resp) => {\n                    values.push({ target_id: resp.data.id });\n                    // datas[i].entity = resp.data.json;\n                    i = i + 1;\n                    if (i < datas.length) {\n                      resolv(loopEntityPromise(datas, i));\n                    } else resolv(values);\n                  })\n                  .catch((er) => {\n                    console.log(\"catch : \", er);\n                    reject(er);\n                  });\n              });\n            }\n            // S'il ne contient pas de sous entité.\n            else {\n              this.$store\n                .dispatch(\"saveEntity\", {\n                  entity_type_id: datas[i].target_type,\n                  value: datas[i].entity,\n                  index: i,\n                })\n                .then((resp) => {\n                  values.push({ target_id: resp.data.id });\n                  // datas[i].entity = resp.data.json;\n                  i = i + 1;\n                  if (i < datas.length) {\n                    resolv(loopEntityPromise(datas, i));\n                  } else resolv(values);\n                })\n                .catch((er) => {\n                  console.log(\"catch : \", er);\n                  reject(er);\n                });\n            }\n          } else {\n            console.log(\" loopEntityPromise END \");\n            resolv([]);\n          }\n        });\n      };\n      loopEntityPromise(state.entityDuplicate, 0);\n    },\n  },\n};\n</script>\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-120[0].rules[0].use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./TextDuplicateEntities.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-120[0].rules[0].use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./TextDuplicateEntities.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./TextDuplicateEntities.vue?vue&type=template&id=b2f7253a&\"\nimport script from \"./TextDuplicateEntities.vue?vue&type=script&lang=js&\"\nexport * from \"./TextDuplicateEntities.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","on","duplicateEntities","_v","_s","numbersEntities","staticRenderFns","name","data","payload","id","content","value","field_domain_access","target_id","field_domain_source","is_default_theme","computed","mapState","mapGetters","mounted","methods","$store","dispatch","then","prepareSaveEntities","state","Promise","console","log","items","i","entities","loopFieldEntity","keys","entity_type_id","index","values","resolv","catch","reject","datas","fieldname","length","loopItem","resp","entity","loopEntityPromise","entityDuplicate","component"],"sourceRoot":""}